<div class="cropper-container h-full flex">
    <!-- Side Panel for Controls -->
    <div class="side-panel bg-gray-100 border-r flex flex-col" [class.w-80]="showConfigEditor()" [class.w-64]="!showConfigEditor()">
        <!-- Control Panel Header -->
        <div class="control-panel p-4 border-b">
            <div class="flex flex-col gap-4">
                <!-- Image Upload Section -->
                <div class="flex flex-col gap-2">
                    <h3 class="font-semibold text-gray-700">Image Upload</h3>
                    <label for="imageUpload" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded cursor-pointer transition-colors text-center"> Upload Image </label>
                    <input id="imageUpload" type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden" />
                </div>

                <!-- Config Controls -->
                <div class="flex flex-col gap-2">
                    <h3 class="font-semibold text-gray-700">Configuration</h3>
                    <button (click)="toggleConfigEditor()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors">
                        {{ showConfigEditor() ? 'Hide Editor' : 'Show Editor' }}
                    </button>

                    <button (click)="resetConfig()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded transition-colors">Reset to Default</button>
                </div>
            </div>
        </div>

        <!-- JSON Config Editor -->
        @if (showConfigEditor()) {
        <div class="flex-1 p-4 overflow-hidden">
            <div class="flex flex-col gap-2 h-full">
                <label for="configTextarea" class="font-semibold text-gray-700">JSON Configuration Editor:</label>
                <textarea
                    #configJsonTextarea
                    id="configTextarea"
                    [(ngModel)]="configJsonString"
                    class="flex-1 p-3 border border-gray-300 rounded-md font-mono text-sm resize-none"
                    placeholder="Edit the cropper configuration in JSON format..."
                ></textarea>
                <div class="flex gap-2">
                    <button (click)="applyConfig()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors flex-1">Apply Changes</button>
                    <button (click)="updateJsonString()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors flex-1">Refresh JSON</button>
                </div>
            </div>
        </div>
        }
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col">
        <!-- Cropper with built-in toolbar -->
        <ngCropper
            class="h-full flex-1"
            #cropper
            [showToolbar]="config().toolbar.show"
            [toolbarPosition]="config().toolbar.position"
            [canvasConfig]="config().partials.canvas"
            [canvasHidden]="config().canvas.hidden"
            [canvasBackground]="config().canvas.background"
            [canvasDisabled]="config().canvas.disabled"
            [canvasScaleStep]="config().canvas.scaleStep"
            [canvasThemeColor]="config().canvas.themeColor"
            [imageConfig]="config().partials.image"
            [imageHidden]="config().image.hidden"
            [imageRotatable]="config().image.rotatable"
            [imageScalable]="config().image.scalable"
            [imageSkewable]="config().image.skewable"
            [imageTranslatable]="config().image.translatable"
            [imageInitialCenterSize]="config().image.initialCenterSize"
            [imageSrc]="config().image.src"
            [imageAlt]="config().image.alt"
            [shadeConfig]="config().partials.shade"
            [shadeHidden]="config().shade.hidden"
            [shadeThemeColor]="config().shade.themeColor"
            [selectionConfig]="config().partials.selection"
            [selectionHidden]="config().selection.hidden"
            [selectionX]="config().selection.x"
            [selectionY]="config().selection.y"
            [selectionWidth]="config().selection.width"
            [selectionHeight]="config().selection.height"
            [selectionAspectRatio]="config().selection.aspectRatio"
            [selectionInitialAspectRatio]="config().selection.initialAspectRatio"
            [selectionInitialCoverage]="config().selection.initialCoverage"
            [selectionDynamic]="config().selection.dynamic"
            [selectionMovable]="config().selection.movable"
            [selectionResizable]="config().selection.resizable"
            [selectionZoomable]="config().selection.zoomable"
            [selectionMultiple]="config().selection.multiple"
            [selectionKeyboard]="config().selection.keyboard"
            [selectionOutlined]="config().selection.outlined"
            [selectionPrecise]="config().selection.precise"
            [gridConfig]="config().partials.grid"
            [gridHidden]="config().grid.hidden"
            [gridRows]="config().grid.rows"
            [gridColumns]="config().grid.columns"
            [gridBordered]="config().grid.bordered"
            [gridCovered]="config().grid.covered"
            [gridThemeColor]="config().grid.themeColor"
            [crosshairConfig]="config().partials.crosshair"
            [crosshairHidden]="config().crosshair.hidden"
            [crosshairCentered]="config().crosshair.centered"
            [crosshairThemeColor]="config().crosshair.themeColor"
            [handlesHidden]="config().handles.hidden"
            [handlesThemeColor]="config().handles.themeColor"
        />
    </div>
</div>
